<h2 mat-dialog-title>{{ isEditMode ? 'Editar Producto' : 'Añadir Nuevo Producto' }}</h2>

<mat-dialog-content>
    <form [formGroup]="productForm" class="product-form">

        <!-- Nombre (Full Width) -->
        <mat-form-field appearance="outline" class="full-width">
            <mat-label>Nombre del Producto</mat-label>
            <input matInput formControlName="name" placeholder="Ej. Laptop Gamer">
        </mat-form-field>
        <!-- NUEVO: Descripción -->
        <mat-form-field appearance="outline" class="full-width">
            <mat-label>Descripción</mat-label>
            <textarea matInput formControlName="description" rows="3" placeholder="Breve descripción..."></textarea>
        </mat-form-field>
        <div class="form-row">
            <!-- SKU -->
            <mat-form-field appearance="outline">
                <mat-label>SKU</mat-label>
                <input matInput formControlName="sku" placeholder="ELEC-001">
            </mat-form-field>

            <!-- Categoría -->
            <mat-form-field appearance="outline">
                <mat-label>Categoría</mat-label>
                <mat-select formControlName="categoryId">
                    <!-- Bucle dinámico -->
                    <mat-option *ngFor="let cat of categories" [value]="cat.id">
                        {{ cat.name }}
                    </mat-option>
                </mat-select>
            </mat-form-field>

        </div>
        <!-- Solo mostrar al editar -->
        <div class="form-row" *ngIf="isEditMode">
            <mat-form-field appearance="outline" class="full-width">
                <mat-label>Estado</mat-label>
                <mat-select formControlName="status">
                    <mat-option value="active">Activo</mat-option>
                    <mat-option value="inactive">Inactivo</mat-option>
                    <mat-option value="discontinued">Descontinuado</mat-option>
                </mat-select>
            </mat-form-field>
        </div>

        <div class="form-row">
            <!-- Precio -->
            <mat-form-field appearance="outline">
                <mat-label>Precio</mat-label>
                <span matPrefix>$ &nbsp;</span>
                <input matInput type="number" formControlName="price">
            </mat-form-field>

            <!-- Stock -->
            <mat-form-field appearance="outline">
                <mat-label>Stock</mat-label>
                <input matInput type="number" formControlName="quantityInStock">
            </mat-form-field>
        </div>

        <!-- ZONA DE CARGA DE IMAGEN (Estilo Referencia) -->
        <div class="image-upload-container">
            <label class="upload-label">Imagen del Producto</label>

            <div class="upload-area" (click)="fileInput.click()">

                <!-- Si hay imagen (preview o existente), mostrarla -->
                <img *ngIf="imagePreview" [src]="imagePreview" class="preview-img">

                <!-- Si no, mostrar placeholder -->
                <div *ngIf="!imagePreview" class="placeholder-content">
                    <mat-icon class="upload-icon">cloud_upload</mat-icon>
                    <p><strong>Click para subir</strong> o arrastra y suelta</p>
                    <span class="subtext">SVG, PNG, JPG (MAX. 5MB)</span>
                </div>

                <input #fileInput type="file" (change)="onFileSelected($event)" hidden accept="image/*">
            </div>
        </div>

    </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
    <button mat-button (click)="onCancel()">Cancelar</button>
    <button mat-raised-button color="primary" class="btn-primary" (click)="onSave()" [disabled]="productForm.invalid">
        {{ isEditMode ? 'Guardar Cambios' : 'Crear Producto' }}
    </button>
</mat-dialog-actions>