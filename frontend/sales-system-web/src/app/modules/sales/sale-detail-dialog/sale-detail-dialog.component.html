<div class="ticket-container" *ngIf="sale; else loadingTpl">

    <!-- Cabecera -->
    <div class="header">
        <div class="header-left">
            <h2 class="title">Detalle de Venta</h2>
            <span class="sale-number">#{{ sale.saleNumber }}</span>
        </div>
        <div class="header-right">
            <span class="status-badge" [class.completed]="sale.status === 'completed'">
                {{ sale.status | titlecase }}
            </span>
        </div>
    </div>

    <mat-divider></mat-divider>

    <!-- Info General -->
    <div class="info-grid">
        <div class="info-item">
            <span class="label">Fecha</span>
            <span class="value">{{ sale.createdAt | date:'medium' }}</span>
        </div>
        <div class="info-item">
            <span class="label">Vendedor</span>
            <span class="value">{{ sale.userName }}</span>
        </div>
        <div class="info-item">
            <span class="label">Cliente</span>
            <!-- Si tienes campo customerName en Sale, úsalo aquí. Si no, usa Notes o Placeholder -->
            <span class="value">{{ 'Cliente General' }}</span>
        </div>
        <div class="info-item">
            <span class="label">Método Pago</span>
            <span class="value">{{ sale.paymentMethodName }}</span>
        </div>
    </div>

    <!-- Tabla Productos -->
    <div class="products-section">
        <table mat-table [dataSource]="sale.details || []" class="details-table">

            <!-- Producto -->
            <ng-container matColumnDef="product">
                <th mat-header-cell *matHeaderCellDef> Producto </th>
                <td mat-cell *matCellDef="let item"> {{ item.productName }} </td>
            </ng-container>

            <!-- Cantidad -->
            <ng-container matColumnDef="quantity">
                <th mat-header-cell *matHeaderCellDef class="text-center"> Cant. </th>
                <td mat-cell *matCellDef="let item" class="text-center"> {{ item.quantity }} </td>
            </ng-container>

            <!-- Precio Unit -->
            <ng-container matColumnDef="price">
                <th mat-header-cell *matHeaderCellDef class="text-right"> Precio </th>
                <td mat-cell *matCellDef="let item" class="text-right"> ${{ item.unitPrice | number:'1.2-2' }} </td>
            </ng-container>

            <!-- Subtotal -->
            <ng-container matColumnDef="subtotal">
                <th mat-header-cell *matHeaderCellDef class="text-right"> Total </th>
                <td mat-cell *matCellDef="let item" class="text-right font-bold"> ${{ item.subtotal | number:'1.2-2' }}
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
    </div>

    <mat-divider></mat-divider>

    <!-- Total Final -->
    <div class="footer-total">
        <span class="total-label">TOTAL A PAGAR</span>
        <span class="total-amount">${{ sale.totalAmount | number:'1.2-2' }}</span>
    </div>

    <!-- Botones Acción -->
    <div class="actions">
        <button mat-stroked-button (click)="printTicket()">
            <mat-icon class="mr-2">print</mat-icon> Imprimir
        </button>
        <button mat-raised-button color="primary" (click)="close()">Cerrar</button>
    </div>

</div>

<ng-template #loadingTpl>
    <div class="loading-state">
        <p>Cargando detalle...</p>
    </div>
</ng-template>