<div class="page-header">
    <h1 class="page-title">Gestión de Productos</h1>
    <button class="btn-primary" (click)="openProductDialog()">
        <mat-icon class="mr-2">add</mat-icon> Añadir Producto
    </button>
</div>

<!-- FILTROS -->
<div class="filters-container">
    <mat-form-field appearance="outline" class="search-field">
        <mat-icon matPrefix>search</mat-icon>
        <input matInput placeholder="Buscar por nombre o SKU" [(ngModel)]="searchTerm" (keyup.enter)="onSearch()">
    </mat-form-field>

    <mat-form-field appearance="outline" class="status-field">
        <mat-label>Estado</mat-label>
        <mat-select [(ngModel)]="selectedStatus" (selectionChange)="onSearch()">
            <mat-option value="Todos">Todos</mat-option>
            <mat-option value="active">Activo</mat-option>
            <mat-option value="inactive">Inactivo</mat-option>
        </mat-select>
    </mat-form-field>
</div>

<!-- TABLA -->
<mat-card class="table-card">
    <div class="table-container">
        <table mat-table [dataSource]="products">

            <!-- Imagen -->
            <ng-container matColumnDef="image">
                <th mat-header-cell *matHeaderCellDef> Imagen </th>
                <td mat-cell *matCellDef="let product">
                    <div class="product-img-container">
                        <img [src]="product.imageUrl || 'assets/placeholder-product.png'" alt="Product"
                            class="product-thumb">
                    </div>
                </td>
            </ng-container>

            <!-- Nombre -->
            <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef> Nombre </th>
                <td mat-cell *matCellDef="let product" class="font-medium"> {{ product.name }} </td>
            </ng-container>

            <!-- SKU -->
            <ng-container matColumnDef="sku">
                <th mat-header-cell *matHeaderCellDef> SKU </th>
                <td mat-cell *matCellDef="let product" class="text-gray-500"> {{ product.sku }} </td>
            </ng-container>

            <!-- Categoría -->
            <ng-container matColumnDef="category">
                <th mat-header-cell *matHeaderCellDef> Categoría </th>
                <td mat-cell *matCellDef="let product"> {{ product.categoryName }} </td>
            </ng-container>

            <!-- Precio -->
            <ng-container matColumnDef="price">
                <th mat-header-cell *matHeaderCellDef> Precio </th>
                <td mat-cell *matCellDef="let product" class="font-bold"> ${{ product.price | number:'1.2-2' }} </td>
            </ng-container>

            <!-- Stock -->
            <ng-container matColumnDef="stock">
                <th mat-header-cell *matHeaderCellDef> Stock </th>
                <td mat-cell *matCellDef="let product">
                    <span [class.text-red-600]="product.quantityInStock < product.minStock">
                        {{ product.quantityInStock }}
                    </span>
                </td>
            </ng-container>

            <!-- Estado -->
            <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef> Estado </th>
                <td mat-cell *matCellDef="let product">
                    <span class="badge" [ngClass]="getStatusClass(product.status)">
                        {{ product.status | titlecase }}
                    </span>
                </td>
            </ng-container>

            <!-- Acciones -->
            <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef> Acciones </th>
                <td mat-cell *matCellDef="let product">
                    <button mat-icon-button color="primary" (click)="openProductDialog(product)" matTooltip="Editar">
                        <mat-icon>edit</mat-icon>
                    </button>
                    <button mat-icon-button color="warn" (click)="deleteProduct(product.id)" matTooltip="Eliminar">
                        <mat-icon>delete</mat-icon>
                    </button>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

            <!-- Fila vacía si no hay datos -->
            <tr class="mat-row" *matNoDataRow>
                <td class="mat-cell p-8 text-center" [attr.colspan]="displayedColumns.length">
                    No se encontraron productos que coincidan con "{{searchTerm}}"
                </td>
            </tr>
        </table>
    </div>

    <!-- Paginador (Opcional, si el backend soporta paginación) -->
    <!-- <mat-paginator [pageSizeOptions]="[5, 10, 25]" showFirstLastButtons></mat-paginator> -->
</mat-card>